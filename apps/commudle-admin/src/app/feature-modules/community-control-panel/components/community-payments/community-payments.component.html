<section class="com-p-4">
  <div class="com-my-3">
    <button
      class="!com-bg-Blue-Lotus hover:!com-bg-Blue-Lotus/90"
      (click)="openDialogBox(StripeConnectAccount)"
      nbButton
      status="primary"
    >
      <span class="com-font-semibold com-text-xs"> Connect to </span>
      <!-- for stripe text on button -->
      <svg width="38" height="18" viewBox="0 0 38 18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M34.0004 9.19973C34.0004 7.14895 32.9671 5.53076 30.9921 5.53076C29.0088 5.53076 27.8088 7.14895 27.8088 9.18371C27.8088 11.595 29.2254 12.8126 31.2588 12.8126C32.2504 12.8126 33.0004 12.5963 33.5671 12.2919V10.6897C33.0004 10.9621 32.3504 11.1303 31.5254 11.1303C30.7171 11.1303 30.0004 10.858 29.9088 9.9127H33.9838C33.9838 9.80855 34.0004 9.39199 34.0004 9.19973ZM29.8838 8.4387C29.8838 7.53347 30.4588 7.15696 30.9838 7.15696C31.4921 7.15696 32.0338 7.53347 32.0338 8.4387H29.8838Z"
          fill="white"
        />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M24.5919 5.53076C23.7752 5.53076 23.2502 5.89926 22.9586 6.15561L22.8502 5.65894H21.0169V14.9996L23.1002 14.575L23.1086 12.3079C23.4086 12.5162 23.8502 12.8126 24.5836 12.8126C26.0752 12.8126 27.4336 11.6591 27.4336 9.11962C27.4252 6.79648 26.0502 5.53076 24.5919 5.53076ZM24.0919 11.0502C23.6002 11.0502 23.3086 10.882 23.1086 10.6737L23.1002 7.7017C23.3169 7.46939 23.6169 7.30917 24.0919 7.30917C24.8502 7.30917 25.3752 8.12628 25.3752 9.1757C25.3752 10.2492 24.8586 11.0502 24.0919 11.0502Z"
          fill="white"
        />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M18.1506 5.0583L20.2422 4.62571V2.99951L18.1506 3.42409V5.0583Z"
          fill="white"
        />
        <path d="M20.2422 5.66748H18.1506V12.677H20.2422V5.66748Z" fill="white" />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M15.9081 6.2591L15.7748 5.6663H13.9748V12.6758H16.0581V7.92536C16.5498 7.30852 17.3831 7.42068 17.6415 7.5088V5.6663C17.3748 5.57017 16.3998 5.39393 15.9081 6.2591Z"
          fill="white"
        />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M11.742 3.9292L9.70871 4.34576L9.70038 10.7625C9.70038 11.9481 10.6254 12.8212 11.8587 12.8212C12.542 12.8212 13.042 12.7011 13.317 12.5569V10.9307C13.0504 11.0348 11.7337 11.4033 11.7337 10.2177V7.37386H13.317V5.66755H11.7337L11.742 3.9292Z"
          fill="white"
        />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M6.10852 7.7017C6.10852 7.38928 6.37518 7.26912 6.81685 7.26912C7.45018 7.26912 8.25018 7.45336 8.88351 7.78181V5.89926C8.19185 5.6349 7.50852 5.53076 6.81685 5.53076C5.12518 5.53076 4.00018 6.37991 4.00018 7.79783C4.00018 10.0088 7.16685 9.65635 7.16685 10.6096C7.16685 10.9781 6.83352 11.0983 6.36685 11.0983C5.67518 11.0983 4.79185 10.8259 4.09185 10.4574V12.364C4.86685 12.6844 5.65018 12.8206 6.36685 12.8206C8.10018 12.8206 9.29185 11.9955 9.29185 10.5616C9.28351 8.17434 6.10852 8.59892 6.10852 7.7017Z"
          fill="white"
        />
      </svg>
    </button>
  </div>

  <app-loading-spinner *ngIf="isUpdating"></app-loading-spinner>

  <table *ngIf="stripeAccounts.length > 0" class="com-mt-4">
    <tr>
      <th>Active</th>
      <th>Actions</th>
      <th>Charges Enabled</th>
      <th>Payouts Enabled</th>
      <th>Bank Details</th>
    </tr>
    <tr *ngFor="let stripeAccount of stripeAccounts">
      <td>
        <p>{{ stripeAccount.active }}</p>
      </td>
      <td>
        <a>{{ stripeAccount.details.external_accounts.url }}</a>
      </td>
      <td>
        <p>{{ stripeAccount.details.charges_enabled }}</p>
      </td>
      <td>
        <p>{{ stripeAccount.details.payouts_enabled }}</p>
      </td>
      <td>
        <div *ngIf="stripeAccount.details.external_accounts.data.length >= 1">
          <details *ngFor="let bankDetails of stripeAccount.details.external_accounts.data">
            <summary>{{ bankDetails.bank_name }}</summary>
            <p>
              Account Number: <span>{{ bankDetails.routing_number }}</span>
              <br />
              <span>{{ bankDetails.account_holder_name }}</span>
              <br />
              <span>{{ bankDetails.currency | uppercase }}</span>
            </p>
          </details>
        </div>
        <div *ngIf="stripeAccount.details.external_accounts.data.length <= 0">
          <strong> No Band Details Found </strong>
        </div>
      </td>
    </tr>
  </table>
</section>

<ng-template #StripeConnectAccount let-data let-ref="dialogRef">
  <nb-card class="com-max-h-[90dvh]">
    <nb-card-header>
      <div class="com-flex com-justify-between">
        <div>Create Stripe Account</div>
        <button (click)="ref.close(); stripeConnectAccountForm.reset()" ghost nbButton shape="round" size="small">
          <nb-icon icon="close"></nb-icon>
        </button>
      </div>
    </nb-card-header>
    <nb-card-body>
      <form [formGroup]="stripeConnectAccountForm" *ngIf="!isLoading">
        <div class="com-flex com-flex-col com-gap-3">
          <!-- Name* -->
          <label>
            Name*
            <input fieldSize="small" formControlName="name" placeholder="Name" fullWidth nbInput type="string" />
            <span
              *ngIf="
                stripeConnectAccountForm.get('name').touched &&
                stripeConnectAccountForm.get('name').invalid &&
                stripeConnectAccountForm.get('name').errors.required
              "
            >
              <commudle-alert [error]="true" [errorMessage]="'Required Field'"></commudle-alert>
            </span>
          </label>

          <!-- Email* -->
          <label>
            Email*
            <input fieldSize="small" formControlName="email" placeholder="Email" fullWidth nbInput type="email" />
            <span
              *ngIf="
                stripeConnectAccountForm.get('email').touched &&
                stripeConnectAccountForm.get('email').invalid &&
                stripeConnectAccountForm.get('email').errors.required
              "
            >
              <commudle-alert [error]="true" [errorMessage]="'Required Field'"></commudle-alert>
            </span>
          </label>

          <!-- Phone* -->
          <label>
            Phone*
            <div class="com-flex com-flex-row com-gap-2 com-h-auto">
              <div class="select !com-w-32">
                <select formControlName="phone_country_code">
                  <option *ngFor="let country of countries" [value]="country.phone">
                    +{{ country.phone }}({{ country.name }})
                  </option>
                </select>
              </div>
              <input
                fieldSize="small"
                formControlName="phone"
                placeholder="Phone Number"
                fullWidth
                nbInput
                type="number"
              />
            </div>
            <span
              *ngIf="
                stripeConnectAccountForm.get('phone').touched &&
                stripeConnectAccountForm.get('phone').invalid &&
                stripeConnectAccountForm.get('phone').errors.required
              "
            >
              <commudle-alert [error]="true" [errorMessage]="'Required Field'"></commudle-alert>
            </span>
          </label>

          <!-- Address* -->
          <label>
            Address*
            <textarea fieldSize="small" formControlName="address" placeholder="Address" fullWidth nbInput type="string">
            </textarea>
            <span
              *ngIf="
                stripeConnectAccountForm.get('address').touched &&
                stripeConnectAccountForm.get('address').invalid &&
                stripeConnectAccountForm.get('address').errors.required
              "
            >
              <commudle-alert [error]="true" [errorMessage]="'Required Field'"></commudle-alert>
            </span>
          </label>

          <!-- Country* -->
          <label>
            country*
            <div class="select !com-mt-0">
              <select formControlName="country">
                <option value="" selected disabled>Select Bank Ac</option>
                <option *ngFor="let country of countries" [value]="country.name">
                  {{ country.name }}
                </option>
              </select>
            </div>
            <span
              *ngIf="
                stripeConnectAccountForm.get('country').touched &&
                stripeConnectAccountForm.get('country').invalid &&
                stripeConnectAccountForm.get('country').errors.required
              "
            >
              <commudle-alert [error]="true" [errorMessage]="'Required Field'"></commudle-alert>
            </span>
          </label>

          <!-- city and state -->
          <div class="com-flex com-gap-3">
            <!-- City* -->
            <label>
              City*
              <input fieldSize="small" formControlName="city" placeholder="City" fullWidth nbInput type="string" />
              <span
                *ngIf="
                  stripeConnectAccountForm.get('city').touched &&
                  stripeConnectAccountForm.get('city').invalid &&
                  stripeConnectAccountForm.get('city').errors.required
                "
              >
                <commudle-alert [error]="true" [errorMessage]="'Required Field'"></commudle-alert>
              </span>
            </label>

            <!-- State* -->
            <label>
              State*
              <input fieldSize="small" formControlName="state" placeholder="State" fullWidth nbInput type="string" />
              <span
                *ngIf="
                  stripeConnectAccountForm.get('state').touched &&
                  stripeConnectAccountForm.get('state').invalid &&
                  stripeConnectAccountForm.get('state').errors.required
                "
              >
                <commudle-alert [error]="true" [errorMessage]="'Required Field'"></commudle-alert>
              </span>
            </label>
          </div>

          <!-- Zip Code* -->
          <label>
            Zip Code*
            <input
              fieldSize="small"
              formControlName="zip_code"
              placeholder="Zip Code"
              fullWidth
              nbInput
              type="string"
            />
            <span
              *ngIf="
                stripeConnectAccountForm.get('name').touched &&
                stripeConnectAccountForm.get('name').invalid &&
                stripeConnectAccountForm.get('name').errors.required
              "
            >
              <commudle-alert [error]="true" [errorMessage]="'Required Field'"></commudle-alert>
            </span>
          </label>
        </div>
      </form>
      <div *ngIf="isLoading">
        <p class="com-text-center com-font-bold">Connecting to Stripe Account......</p>
        <app-loading-spinner></app-loading-spinner>
      </div>
    </nb-card-body>

    <nb-card-footer>
      <div class="save-button-bottom">
        <button
          (click)="connectStripeAccount()"
          [disabled]="!stripeConnectAccountForm.valid || isLoading"
          fullWidth
          nbButton
          size="small"
          status="primary"
          type="submit"
          [nbSpinner]="isLoading"
        >
          Proceed
        </button>
      </div>
    </nb-card-footer>
  </nb-card>
</ng-template>
