<button nbButton status="primary" (click)="open(dialog)" class="create-button">Create Discount Coupon</button>

<div class="discount-codes">
  <table *ngFor="let discountCode of discountCodes">
    <tr>
      <th class="heading">Code</th>
      <th class="heading">Expire</th>
      <th>
        <div class="action-button" (click)="open(dialog, discountCode)">
          <fa-icon [icon]="icons.faPenToSquare"></fa-icon>
          <span> Edit </span>
        </div>
      </th>
    </tr>
    <tr>
      <td class="content">{{ discountCode.code }}</td>
      <td class="content">{{ discountCode.expires_at | date : 'dd-MM-yy hh:mm a' }}</td>

      <td>
        <div class="action-button" (click)="copyTextToClipboard(discountCode.code)">
          <fa-icon [icon]="icons.faCopy"></fa-icon>
          <span> Copy </span>
        </div>
      </td>
    </tr>
  </table>
</div>

<ng-template #dialog let-data let-ref="dialogRef">
  <nb-card class="com-max-h-[80dvh] com-w-full md:com-w-50vw">
    <nb-card-header>
      <div class="com-flex com-justify-between">
        <div>{{ data.type | titlecase }} Discount Coupon</div>

        <button (click)="ref.close(); discountCouponForm.reset()" ghost nbButton shape="round" size="small">
          <nb-icon icon="close"></nb-icon>
        </button>
      </div>
    </nb-card-header>
    <nb-card-body>
      <form [formGroup]="discountCouponForm">
        <div formGroupName="discount_code" class="com-flex com-flex-col com-gap-3">
          <!-- Name -->
          <label>
            Name*
            <input formControlName="code" fullWidth nbInput type="text" placeholder="Coupon Name" />
          </label>

          <!-- Discount type* -->
          <label class="com-col-span-1">
            Discount type*
            <nb-select formControlName="discount_type" fullWidth placeholder="Select Discount Type">
              <nb-option value="percent"> Percent </nb-option>
              <nb-option value="fixed_amount"> Value </nb-option>
            </nb-select>
          </label>

          <!-- Is Limited* -->
          <label class="com-col-span-1 com-flex com-items-center com-gap-2">
            <input formControlName="is_limited" type="checkbox" />
            <span class="com-text-primary-500 com-font-medium"> Limited Users </span>
          </label>
          <!-- Max Limit* -->
          <label
            class="com-col-span-1"
            *ngIf="discountCouponForm.controls.discount_code.get('is_limited').value === true"
          >
            Max Limit*
            <input formControlName="max_limit" nbInput fullWidth type="number" placeholder="Max Limit" />
          </label>

          <!-- Discount value* -->
          <label class="com-col-span-1">
            Discount value*
            <input formControlName="discount_value" fullWidth nbInput type="number" placeholder=" Discount value" />
          </label>

          <!-- Expires At* -->
          <label class="com-col-span-1">
            Expires At*
            <input formControlName="expires_at" fullWidth nbInput type="datetime-local" />
          </label>

          <!-- Event Data Form Entity Group Ids* -->
          <div>
            <label class="com-col-span-1 com-my-4"> Select the form in which you want to apply coupon* </label>
            <br />
            <div class="com-flex com-justify-between com-flex-wrap">
              <div
                *ngFor="let edfeg of eventDataFormEntityGroups; let i = index"
                class="com-flex com-items-center com-gap-2"
              >
                <input
                  type="checkbox"
                  [checked]="selectedEventDataFormEntityGroups.includes(edfeg.id)"
                  [value]="edfeg.id"
                  (change)="addEventDataForm($event)"
                />
                <span class="com-text-primary-500 com-font-semibold">
                  {{ edfeg.name }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </form>
    </nb-card-body>
    <nb-card-footer>
      <div class="com-flex com-gap-6 com-mx-4">
        <button
          nbButton
          status="primary"
          (click)="data.type === 'edit' ? savedDiscountCouponData(data.id) : savedDiscountCouponData(); ref.close()"
          [disabled]="!discountCouponForm.valid || selectedEventDataFormEntityGroups.length === 0"
        >
          {{ data.type === 'edit' ? 'Update' : data.type }}
        </button>
        <button nbButton status="danger" outline (click)="ref.close(); discountCouponForm.reset()">Cancel</button>
      </div>
    </nb-card-footer>
  </nb-card>
</ng-template>
